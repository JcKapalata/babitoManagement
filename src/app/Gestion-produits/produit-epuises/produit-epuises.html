<div class="container">
  <div class="title">
    <h2>Stock Épuisés</h2>
  </div>

  <div class="main-content">
    @if (epuises$ | async; as produits) {
      <div class="table-wrapper">
        
        <table class="rupture-table header-only">
          <thead>
            <tr>
              <th class="col-data">Date épuisement</th>
              <th class="col-id">Code Produit</th>
              <th class="col-produit">Produit</th>
              <th class="col-taille">Taille</th>
              <th class="col-couleur">Couleur</th>
              <th class="col-action">Action</th>
            </tr>
          </thead>
        </table>

        <cdk-virtual-scroll-viewport itemSize="60" class="viewport">
          <table class="rupture-table">
            <tbody>
              @for (item of produits; track item.idUnique) {
                <tr class="table-row">
                  <td class="col-data">
                    <span class="badge-date">{{ item.updateAt | date:'dd/MM/yyyy' }}</span>
                    <span class="time-text">{{ item.updateAt | date:'HH:mm' }}</span>
                  </td>

                  <td class="col-id">
                    <span>{{ item.codeProduit }}</span>
                  </td>

                  <td class="col-produit">
                    <div class="product-info">
                      <img [src]="item.image || 'assets/placeholder.png'" class="thumb" loading="lazy">
                      <strong>{{ item.nom }}</strong>
                    </div>
                  </td>

                  <td class="col-taille">
                    <span class="badge-taille">{{ item.taille }}</span>
                  </td>

                  <td class="col-couleur">
                    <span class="text-muted">{{ item.couleur }}</span>
                  </td>

                  <td class="col-action">
                    <button class="btn-manage" (click)="goToDetailProduit(item.produitId)">
                      Gérer
                    </button>
                  </td>
                </tr>
              } @empty {
                <tr class="empty-row">
                  <td colspan="6" class="empty-state">Aucun produit en rupture de stock.</td>
                </tr>
              }
            </tbody>
          </table>
        </cdk-virtual-scroll-viewport>
      </div>

    } @else {
      <div class="loading-container">
        <app-loading></app-loading>
      </div>
    }
  </div>
</div>