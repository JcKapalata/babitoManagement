<div class="login-container">
  <mat-card class="login-card">
    <mat-card-header>
      <mat-card-title>Connexion</mat-card-title>
      <mat-card-subtitle>Accédez à votre compte de gestion</mat-card-subtitle>
    </mat-card-header>

    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
      
      @if (errorMessage) {
        <div style="color: #d32f2f; background-color: #fdecea; padding: 10px; border-radius: 4px; margin-bottom: 15px; border: 1px solid #d32f2f; font-size: 13px; display: flex; align-items: center;">
          <mat-icon style="margin-right: 8px; font-size: 18px; width: 18px; height: 18px;">error</mat-icon>
          <span>{{ errorMessage }}</span>
        </div>
      }

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" type="email" placeholder="exemple@mail.com">
        <mat-icon matSuffix>email</mat-icon>
        
        @if (loginForm.get('email')?.hasError('required')) {
          <mat-error>L'email est requis</mat-error>
        }
        @if (loginForm.get('email')?.hasError('email')) {
          <mat-error>Format d'email invalide</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Mot de passe</mat-label>
        <input matInput formControlName="password" [type]="hidePassword ? 'password' : 'text'">
        <button type="button" mat-icon-button matSuffix (click)="hidePassword = !hidePassword" tabindex="-1">
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>

        @if (loginForm.get('password')?.hasError('required')) {
          <mat-error>Le mot de passe est requis</mat-error>
        }
        @if (loginForm.get('password')?.hasError('minlength')){
          <mat-error>Minimum 8 caractères</mat-error>
        }
        
        @if (loginForm.get('password')?.hasError('pattern') && !loginForm.get('password')?.hasError('minlength')) {
          <mat-error style="font-size: 10.5px;">
            Requis : 1 Majuscule, 1 Minuscule, 1 Chiffre et 1 Caractère spécial
          </mat-error>
        }
      </mat-form-field>

      <button mat-raised-button 
              color="primary" 
              class="login-button" 
              type="submit" 
              [disabled]="loginForm.invalid || isLoading">
        @if (!isLoading) {
          <span>SE CONNECTER</span>
        } @else {
          <div class="loading-content" style="display: flex; align-items: center; justify-content: center; gap: 8px;">
            <mat-icon style="animation: spin 2s linear infinite;">autorenew</mat-icon>
            <span>CONNEXION...</span>
          </div>
        }
      </button>
    </form>

    <mat-card-footer>
      <a class="forgot-password" style="cursor: pointer;">Mot de passe oublié ?</a>
    </mat-card-footer>
  </mat-card>
</div>

<style>
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
</style>